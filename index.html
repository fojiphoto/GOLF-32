<!DOCTYPE html>
<html lang="en-us">
  <head>
<link rel="manifest" href="manifest.json">
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Golf Orbit</title>
  <script src="https://assets.msn.com/staticsb/statics/latest/msstart-games-sdk/msstart-v1.0.0-rc.20.min.js"></script>
</head>
  <body style="text-align: center; padding: 0; border: 0; margin: 0;">
      <canvas id="unity-canvas" width=900 height=600 tabindex="-1" style="width: 900px; height: 600px; background: #000000"></canvas>
      <script src="Build/9853637125e801e9aae48e78dbbdcfca.loader.js"></script>
      <script>

          window.addEventListener("load", function () {
              if ("serviceWorker" in navigator) {
                  navigator.serviceWorker.register("ServiceWorker.js");
              }
          });

          if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
              // Mobile device style: fill the whole browser client area with the game canvas:
              var meta = document.createElement('meta');
              meta.name = 'viewport';
              meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
              document.getElementsByTagName('head')[0].appendChild(meta);

              var canvas = document.querySelector("#unity-canvas");
              canvas.style.width = "100%";
              canvas.style.height = "100%";
              canvas.style.position = "fixed";

              document.body.style.textAlign = "left";
          }

          createUnityInstance(document.querySelector("#unity-canvas"), {
              dataUrl: "Build/bffcb0700bfea97f1f8792d27c199a69.data.unityweb",
              frameworkUrl: "Build/83401391d7620cf0e16fd2ee9a39ccd4.framework.js.unityweb",
              codeUrl: "Build/002dcfd148e9a8d775a223990dfec544.wasm.unityweb",
              streamingAssetsUrl: "StreamingAssets",
              companyName: "TapNationSAS",
              productName: "Golf Orbit",
              productVersion: "1.0",
              // matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
              // devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
          });

          createUnityInstance(canvas, config, (progress) => {
              const loaderText = document.getElementById("progress-text");
              if (loaderText) loaderText.textContent = Math.round(progress * 100) + "%";
              if (progress === 1) {
                  document.getElementById("custom-loader").style.display = "none";
              }
          }).then((unityInstance) => {
              window.gameInstance = unityInstance;

              // Load ads only after Unity is ready
              LoadRewardedAd();
              LoadInterstitialAd();
          }).catch((message) => {
              console.error("Unity load failed:", message);
              alert("Failed to load the game.");
          });

      </script>

      <script>
          // GLOBAL variables for ads
          let interstitialAdInstance = null;
          let rewardedAdInstance = null;

          // Load interstitial ad
          function LoadInterstitialAd() {
              $msstart.loadAdsAsync().then(ad => {
                  interstitialAdInstance = ad;
                  console.log('Interstitial loaded');
              }).catch(err => {
                  console.error('Interstitial load failed', err);
              });
          }

          // Show interstitial ad
          function ShowInterstitialAd() {
              if (!interstitialAdInstance) {
                  console.warn('Interstitial ad not loaded');
                  return;
              }
              $msstart.showAdsAsync(interstitialAdInstance.instanceId).then(ad => {
                  ad.showAdsCompletedAsync.then(() => {
                      console.log('Interstitial completed');
                      LoadInterstitialAd(); // Reload for next use
                  }).catch(err => {
                      console.error('Interstitial show error', err);
                  });
              }).catch(err => {
                  console.error('ShowAdsAsync error', err);
              });
          }

          // Load rewarded ad
          function LoadRewardedAd() {
              $msstart.loadAdsAsync(true).then(ad => {
                  rewardedAdInstance = ad;
                  console.log('Rewarded loaded');
              }).catch(err => {
                  console.error('Rewarded load failed', err);
              });
          }

          // Show rewarded ad
          function ShowRewardedAd() {
              if (!rewardedAdInstance) {
                  console.warn('Rewarded ad not loaded');
                  return;
              }

              // 🔇 Mute game audio before showing ad
              if (typeof gameInstance !== 'undefined' && gameInstance.SendMessage) {
                  gameInstance.SendMessage('MSStartIntegration', 'MuteAudio');
              } else {
                  console.error('❌ Unity gameInstance.SendMessage not ready');
                  return; // Exit early if Unity not ready
              }

              $msstart.showAdsAsync(rewardedAdInstance.instanceId).then(ad => {
                  ad.showAdsCompletedAsync.then(() => {
                      console.log('Rewarded ad watched fully');
                      if (typeof gameInstance !== 'undefined' && gameInstance.SendMessage) {
                          gameInstance.SendMessage('MSStartIntegration', 'OnRewardedAdComplete');
                      }
                      // 🔊 Unmute game audio after ad
                      if (typeof gameInstance !== 'undefined' && gameInstance.SendMessage) {
                          gameInstance.SendMessage('MSStartIntegration', 'UnmuteAudio');
                      }
                      LoadRewardedAd(); // Reload for next time
                  }).catch(err => {
                      console.warn('Rewarded ad skipped or failed', err);
                      // 🔊 Unmute game audio even if skipped
                      if (typeof gameInstance !== 'undefined' && gameInstance.SendMessage) {
                          gameInstance.SendMessage('MSStartIntegration', 'UnmuteAudio');
                      }
                  });
              }).catch(err => {
                  console.error('ShowAdsAsync error', err);
                  // 🔊 Unmute game audio on error
                  if (typeof gameInstance !== 'undefined' && gameInstance.SendMessage) {
                      gameInstance.SendMessage('MSStartIntegration', 'UnmuteAudio');
                  }
              });
          }
      </script>

  </body>
</html>
